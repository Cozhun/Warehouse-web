# Система управления складом (Warehouse Web)

Простое веб-приложение для базового управления складскими запасами с возможностями администрирования предприятий.

## Основные возможности

*   **Управление пользователями и предприятиями:**
    *   Регистрация пользователей с созданием нового предприятия (пользователь становится администратором).
    *   Регистрация пользователей с присоединением к существующему предприятию по ID и пригласительному токену.
    *   Аутентификация пользователей.
    *   Просмотр и редактирование профиля пользователя (email, имя, фамилия).
    *   Смена пароля пользователя.
*   **Управление товарами:**
    *   Добавление новых товаров с указанием названия, категории, количества и цены.
    *   Просмотр списка товаров на складе с пагинацией и сортировкой.
    *   Фильтрация товаров по названию (поиск) и категории.
    *   Редактирование количества существующих товаров.
*   **Управление категориями:**
    *   Добавление новых категорий.
*   **Дашборд:**
    *   Интерактивный дашборд на странице просмотра склада: отображение общего количества товаров, товаров "в наличии", "мало", "нет в наличии".
    *   Клик по карточкам дашборда фильтрует таблицу по соответствующему количеству.
*   **Админ-панель (для администраторов предприятий):**
    *   Доступ к панели администратора (`admin.html`).
    *   **Генерация пригласительных токенов:** Создание одноразовых токенов для приглашения новых пользователей на предприятие с указанием срока действия.
    *   **Управление пользователями предприятия:**
        *   Просмотр списка всех пользователей, зарегистрированных на предприятии.
        *   Изменение статуса администратора (назначение/снятие прав) для других пользователей.
        *   Удаление пользователей с предприятия (связанные записи в логах движения товаров анонимизируются - `UserID` устанавливается в `NULL`).

## Технологический стек

*   **Frontend:** HTML, CSS, JavaScript, Bootstrap 5
*   **Backend:** Node.js, Express.js, bcrypt, crypto
*   **База данных:** PostgreSQL
*   **Контейнеризация:** Docker, Docker Compose

## Запуск проекта

1.  Убедитесь, что у вас установлен Docker и Docker Compose.
2.  Склонируйте репозиторий.
3.  В корневой папке проекта выполните команду: `docker-compose up -d --build` (рекомендуется `--build` при изменениях в коде или Dockerfile).
4.  Приложение будет доступно по адресу `http://localhost:3000`.

## Структура проекта

*   `/`: HTML файлы страниц (index.html, login.html, admin.html и т.д.)
*   `/css`: Стили CSS (custom.css)
*   `/js`: Клиентские скрипты JavaScript (auth.js, admin.js и т.д.)
*   `/img`: Изображения (логотип)
*   `/server`: Серверная часть Node.js (server.js, db.js)
*   `/sql`: SQL скрипты (init.sql)
*   `bootstrap-5.3.3-dist`: Файлы Bootstrap
*   `docker-compose.yml`: Файл конфигурации Docker Compose
*   `Dockerfile`: Файл для сборки образа приложения
*   `README.md`: Этот файл

## Последние изменения и текущий статус

*   **Реализовано:** Система ролей (пользователь/администратор предприятия).
*   **Реализовано:** Механизм регистрации:
    *   Создание нового предприятия (первый пользователь становится администратором).
    *   Присоединение к существующему предприятию по ID и пригласительному токену.
*   **Реализовано:** Базовая админ-панель (`admin.html`) с доступом только для администраторов.
*   **Функции админ-панели:**
    *   Генерация пригласительных токенов с указанием срока действия.
    *   Просмотр списка пользователей предприятия.
    *   Назначение/снятие прав администратора для пользователей.
    *   Удаление пользователей (связанные `ProductLogs.UserID` устанавливаются в `NULL`).
*   **Обновлена структура БД:** Таблица `Users` дополнена полями `FirstName`, `LastName`, `IsAdmin`. Добавлена таблица `InvitationTokens`.
*   **Улучшено логирование** на стороне сервера (запросы к БД, HTTP-запросы).
*   **Предыдущие исправления и функционал** (дашборд, управление товарами/категориями) сохранены и работают в контексте новых изменений.

**Текущее состояние:** Основной пользовательский функционал и базовый административный функционал реализованы. Система позволяет управлять пользователями и их доступом в рамках предприятий.

## Возможные дальнейшие шаги

*   **Улучшение логирования и детализация операций:**
    *   Пересмотреть поле `Action` в таблице `ProductLogs` для более точной классификации операций (например, `PRODUCT_ADDED`, `ADJUSTMENT_IN`, `ADJUSTMENT_OUT`, `SALE`, `WRITE_OFF`). Это позволит формировать более детальные отчеты о движении товаров, включая отчеты по продажам и списаниям.
*   **Админ-панель (расширение):**
    *   Управление пользователями: сброс пароля.
    *   Просмотр логов сервера (требует настройки логирования в файл/БД и API для их чтения).
    *   Управление предприятием: редактирование названия.
    *   Управление категориями: полный CRUD.
    *   Управление товарами: полный CRUD на уровне админа, массовые операции (изменение категории, цен), импорт/обновление товаров из файла (CSV/XLSX) с предоставлением шаблона.
    *   Управление активными пригласительными токенами (просмотр, отзыв).
*   **Отчетность:**
    *   Разработка модуля отчетов (движение товаров с учетом детализированных `Action`, остатки, оборачиваемость, старение запасов).
    *   Выгрузка отчетов в XLSX, CSV, PDF.
*   **Общие улучшения:**
    *   Более детальная валидация на клиенте и сервере.
    *   Улучшенная обработка ошибок и обратная связь с пользователем.
    *   Добавление тестов (unit, integration).
    *   Рефакторинг и оптимизация кода по мере необходимости.
    *   Улучшение UI/UX. 